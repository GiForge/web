<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEURAL SCAN // HUD v5.0</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-amber: #ffaa00;
            --glass: rgba(10, 15, 20, 0.85);
            --font: 'JetBrains Mono', 'Share Tech Mono', monospace;
        }

        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: #000; overflow: hidden;
            font-family: var(--font); color: #fff;
        }

        /* Fotocamera Full Screen */
        #video-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: 1; filter: contrast(1.1) brightness(0.9);
        }

        /* HUD Frame - Griglia e mirino */
        .hud-overlay {
            position: fixed; inset: 0; z-index: 2; pointer-events: none;
            border: 2px solid rgba(0, 243, 255, 0.1);
            background: 
                linear-gradient(rgba(0,243,255,0.05) 1px, transparent 1px) 0 0 / 50px 50px,
                linear-gradient(90deg, rgba(0,243,255,0.05) 1px, transparent 1px) 0 0 / 50px 50px;
        }

        /* Mirino Centrale */
        .reticle {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 250px; height: 150px; border: 1px solid rgba(0, 243, 255, 0.3);
            z-index: 2; transition: 0.3s;
        }
        .reticle::before {
            content: ''; position: absolute; inset: -10px;
            border: 2px solid var(--neon-blue);
            clip-path: polygon(0 0, 20% 0, 20% 2px, 2px 2px, 2px 20%, 0 20%, 0 0, 80% 0, 100% 0, 100% 20%, 98% 20%, 98% 2px, 80% 2px, 80% 0, 100% 80%, 100% 100%, 80% 100%, 80% 98%, 98% 98%, 98% 80%, 100% 80%, 20% 100%, 0 100%, 0 80%, 2px 80%, 2px 98%, 20% 98%, 20% 100%);
        }

        /* Barra Inferiore Unificata */
        .control-panel {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 500px; z-index: 100;
            background: var(--glass); backdrop-filter: blur(15px);
            border: 1px solid rgba(0, 243, 255, 0.2);
            border-top: 4px solid var(--neon-blue);
            padding: 15px; display: flex; flex-direction: column; gap: 12px;
            clip-path: polygon(0 0, 95% 0, 100% 20%, 100% 100%, 5% 100%, 0 80%);
        }

        .status-row { display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--neon-blue); }

        .action-row { display: flex; gap: 10px; width: 100%; }

        .btn-main {
            flex: 2; background: var(--neon-blue); color: #000; border: none;
            font-family: var(--font); font-weight: bold; font-size: 0.9rem;
            padding: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
            clip-path: polygon(0 0, 90% 0, 100% 50%, 90% 100%, 0 100%);
        }

        .btn-sec {
            flex: 1; background: rgba(0, 243, 255, 0.1); border: 1px solid var(--neon-blue);
            color: var(--neon-blue); padding: 10px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }

        /* Risultati - Cassetto a comparsa */
        .results-drawer {
            position: fixed; top: 20px; right: -100%; width: 85%; max-width: 350px;
            background: var(--glass); backdrop-filter: blur(20px);
            border-left: 2px solid var(--neon-amber); z-index: 110;
            padding: 20px; transition: 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            height: calc(100vh - 150px);
        }
        .results-drawer.open { right: 0; }

        textarea {
            width: 100%; height: 70%; background: rgba(0,0,0,0.4); border: 1px solid rgba(255, 170, 0, 0.2);
            color: #fff; font-family: var(--font); font-size: 0.8rem; padding: 10px;
            box-sizing: border-box; margin-top: 15px; resize: none;
        }

        /* Animazione di scansione */
        .scanner-line {
            position: absolute; width: 100%; height: 2px; background: var(--neon-blue);
            box-shadow: 0 0 15px var(--neon-blue); z-index: 3;
            top: 50%; left: 0; opacity: 0;
        }
        .scanning .scanner-line { animation: scan-move 2s infinite; opacity: 1; }
        @keyframes scan-move { 
            0% { top: 30%; } 50% { top: 70%; } 100% { top: 30%; } 
        }

        #fileInput { display: none; }
    </style>
</head>
<body>

    <video id="video-bg" autoplay playsinline muted></video>
    
    <div class="hud-overlay">
        <div class="reticle" id="reticle">
            <div class="scanner-line"></div>
        </div>
    </div>

    <div id="drawer" class="results-drawer">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--neon-amber); font-weight: bold;">[ DATA_LOG ]</span>
            <i data-lucide="x" style="cursor:pointer" onclick="toggleDrawer()"></i>
        </div>
        <textarea id="output" readonly placeholder="// NO_DATA_ACQUIRED"></textarea>
        <button class="btn-main" style="background: var(--neon-amber); width: 100%; margin-top: 15px;" onclick="copyText()">
            <i data-lucide="clipboard"></i> COPY_TO_MEMORY
        </button>
    </div>

    <div class="control-panel">
        <div class="status-row">
            <span id="sys-status">SYSTEM_READY</span>
            <span id="orient-info">HD_LINK_ACTIVE</span>
        </div>

        <div class="action-row">
            <button class="btn-sec" onclick="toggleTorch()" id="torchBtn">
                <i data-lucide="zap"></i>
            </button>
            
            <button class="btn-main" onclick="captureAndProcess()">
                <i data-lucide="camera"></i> EXECUTE_SCAN
            </button>

            <label for="fileInput" class="btn-sec">
                <i data-lucide="folder-open"></i>
            </label>
            <input type="file" id="fileInput" accept="image/*">
        </div>
        
        <div id="progress-container" style="width: 100%; height: 2px; background: rgba(255,255,255,0.1);">
            <div id="progress-bar" style="width: 0%; height: 100%; background: var(--neon-blue); box-shadow: 0 0 10px var(--neon-blue); transition: 0.3s;"></div>
        </div>
    </div>

    <canvas id="canvas" style="display:none;"></canvas>

<script>
    lucide.createIcons();
    const video = document.getElementById('video-bg');
    const out = document.getElementById('output');
    const pBar = document.getElementById('progress-bar');
    const sysStatus = document.getElementById('sys-status');
    const drawer = document.getElementById('drawer');
    const reticle = document.getElementById('reticle');
    let stream = null;
    let torchOn = false;

    // Inizializza fotocamera
    async function init() {
        try {
            stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: "environment", width: 1280, height: 720 }, 
                audio: false 
            });
            video.srcObject = stream;
        } catch (err) { sysStatus.innerText = "ACCESS_DENIED"; }
    }

    async function captureAndProcess() {
        const canvas = document.getElementById('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);
        
        processOCR(canvas.toDataURL('image/jpeg'));
    }

    async function processOCR(src) {
        reticle.classList.add('scanning');
        sysStatus.innerText = "INITIALIZING_AI...";
        pBar.style.width = "10%";

        try {
            const result = await Tesseract.recognize(src, 'ita+eng', {
                logger: m => {
                    if (m.status === 'recognizing text') {
                        let p = Math.round(m.progress * 100);
                        pBar.style.width = p + "%";
                        sysStatus.innerText = `SCANNING_${p}%`;
                    }
                }
            });
            
            out.value = result.data.text;
            sysStatus.innerText = "COMPLETED";
            reticle.classList.remove('scanning');
            toggleDrawer(true);
        } catch (e) {
            sysStatus.innerText = "FAULT_ERROR";
            reticle.classList.remove('scanning');
        }
    }

    async function toggleTorch() {
        const track = stream.getVideoTracks()[0];
        try {
            torchOn = !torchOn;
            await track.applyConstraints({ advanced: [{ torch: torchOn }] });
            document.getElementById('torchBtn').style.color = torchOn ? 'var(--neon-amber)' : 'var(--neon-blue)';
        } catch (e) { sysStatus.innerText = "HARDWARE_LIMIT"; }
    }

    function toggleDrawer(forceOpen = false) {
        if (forceOpen) drawer.classList.add('open');
        else drawer.classList.toggle('open');
    }

    function copyText() {
        navigator.clipboard.writeText(out.value);
        sysStatus.innerText = "COPIED_TO_BUFFER";
    }

    document.getElementById('fileInput').addEventListener('change', async (e) => {
        const reader = new FileReader();
        reader.onload = () => processOCR(reader.result);
        reader.readAsDataURL(e.target.files[0]);
    });

    init();
</script>
</body>
</html>